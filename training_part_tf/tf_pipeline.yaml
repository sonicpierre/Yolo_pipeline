'on':
  github:
    branches:
      only: main
jobs:
  CloneRepo:
    resources:
      instance-type: C5
    outputs:
      repo:
        type: volume
    uses: git-checkout@v1
    with:
      url: https://github.com/sonicpierre/Yolo_pipeline.git
  Tensorflow:
    resources:
      instance-type: C5
    needs:
      - CloneRepo
    inputs:
      repo: CloneRepo.outputs.repo
    uses: script@v1
    with:
      script: |-
        git clone https://github.com/tensorflow/models.git
        PROTOC_ZIP=protoc-3.15.8-linux-x86_64.zip
        curl -OL https://github.com/google/protobuf/releases/download/v3.15.8/$PROTOC_ZIP
        unzip -o $PROTOC_ZIP -d /usr/local bin/protoc
        unzip -o $PROTOC_ZIP -d /usr/local include/*
        rm -f $PROTOC_ZIP
        protoc models/research/object_detection/protos/*.proto --python_out=.
        python models/research/object_detection/packages/tf2/setup.py
        python -m pip install --use-feature=2020-resolver .
        python models/research/object_detection/builders/model_builder_tf2_test.py
      image: paperspace/gradient-base:tf29-pt112-py39-2022-06-29